<h1>Vulnerability management </h1>
The goal of this project is a showcase of knowledge and skills in vulnerability management, using an
example of the virtual lab with <a href="https://www.tenable.com/downloads/nessus?loginAttempted=true">Nessus Essentials Scanner</a>.
I have pre-installed a small corporate network lab with Windows Server 2016, Active Directory, and Windows 10 Enterprise. {HERE SHOULD BE A LINK TO CREATING LAB WITH AD INSTALLATION,
COMING SOON}
I am using Credentialed Scanning. Method of scanning with credentials of endpoints. In my case it is
an account of an IT worker with admin privileges
<h1>Preparations</h1>
First, I installed Nessus Essentials on the Kali machine. After installation, I created a local account for
scanner, and download plugins (Nessus does it automatically).
It is important to launch Nessus Service in terminal /bin/systemctl start nessusd.service before work

![Screenshot 2023-11-29 174808](https://github.com/PastorEmil/Vulnerability_Managment/assets/125451135/1effd418-bdc5-4453-b00f-0c54bff0b85c)

Before initiating the first scan, I have to do a few procedures on endpoints: 
a turn on Remote Registry, file and printer sharing, and network discovery. That gives Nessus
the ability to scan registry entries of endpoints, for more accurate and full results of credential
scanning, and of course visibility of endpoints.
To enable Remote Registry, I open Services (services.msc) and find the Remote Registry entry.
![Screenshot 2023-11-28 213007](https://github.com/PastorEmil/Vulnerability_Managment/assets/125451135/cd9974a6-a4d3-45e6-a81b-0f4c9b9e62c7)<p>
And set it to “Automatic”. That will turn on the remote registry. Reboot is required.
![Screenshot 2023-11-28 213256](https://github.com/PastorEmil/Vulnerability_Managment/assets/125451135/d5cfbabd-90ef-436a-bd0a-4d58014f6958)<p>
Network Discovery and file and printer sharing. All should be turned on. That will make
endpoints visible.

![Screenshot 2023-11-28 213746](https://github.com/PastorEmil/Vulnerability_Managment/assets/125451135/3f212513-f6a4-4386-8fe8-a527523f656f)

In the registry, on path HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Polici
es\System add a new DWORD LocalAccountTokenFilterPolicy with value 1
That will disable UAC remote restrictions to the scanning process. 
![Screenshot 2023-11-28 215938](https://github.com/PastorEmil/Vulnerability_Managment/assets/125451135/c2b7ad67-a6c7-45c7-9103-da08a5093bb1)
<h1>Scanning</h1>
Now let's initiate the first basic network scan.

![Screenshot 2023-11-29 174612](https://github.com/PastorEmil/Vulnerability_Managment/assets/125451135/9384fa18-3b09-41a2-8081-b6195ef12a88)
Network Scope<br>
192.168.0.1 - Win Server 2016 with AD<br>
192.168.0.2 - Win 10 endpoint (Sales)<br>
192.168.0.3 - Win 10 endpoint (HR)<br>

Wow, this network is pretty vulnerable.☠
![Screenshot 2023-11-18 204852](https://github.com/PastorEmil/Vulnerability_Managment/assets/125451135/3eaebd34-e685-4cc4-8e1f-f538d302082c)

Most of the vulnerabilities are missing OS updates and some outdated software. In my case, it's
WinRAR and 7zip.
A quick look at the results of Windows Server 2016 (endpoints on Win 10 have the same issues)
![Screenshot 2023-11-18 205034](https://github.com/PastorEmil/Vulnerability_Managment/assets/125451135/0d7e3751-b522-4564-a129-fa79b5b60103)

![Screenshot 2023-11-18 205212](https://github.com/PastorEmil/Vulnerability_Managment/assets/125451135/dbfc3c99-e3a9-44e3-a060-f351483d50dc)
<h1>Mitigation</h1>
This is gonna take some time... After downloading fresh OS updates, and upgrading WinRAR with 7Zip, let's check new results.

![Screenshot 2023-11-18 210739](https://github.com/PastorEmil/Vulnerability_Managment/assets/125451135/8478c279-14db-48d5-a1c0-6d8260e38f75).

Much better, but there are still some problems. Let's take a closer look

![Screenshot 2023-11-18 224035](https://github.com/PastorEmil/Vulnerability_Managment/assets/125451135/1ad72cbc-c56e-4457-bccb-297e7681b69d).

![Screenshot 2023-11-18 224240](https://github.com/PastorEmil/Vulnerability_Managment/assets/125451135/46ebd01a-b83b-447c-a6bc-25b79b5ba178)

Looks like there are still some misconfigurations. Let's take a look at the most critical problem. <p>
<a href="https://msrc.microsoft.com/update-guide/en-us/advisory/CVE-2017-8563">CVE-2017-8563</a><br> *Allows an elevation of privilege vulnerability due to Kerberos falling back to NT LAN
Manager (NTLM) Authentication Protocol as the default authentication protocol, aka "Windows
Elevation of Privilege Vulnerability".* Microsoft introduces a registry setting that administrators can
use to help make LDAP authentication over SSL/TLS more secure
![Screenshot 2023-11-18 224550](https://github.com/PastorEmil/Vulnerability_Managment/assets/125451135/fa810f56-6e0e-489c-966e-984ba6b49fbe)
On the registry path HKLM\SYSTEM\CurrentControlSet\Services\NTDS\Parameters i add a new
registry entry LdapEnforceChannelBinding with value 1
![Screenshot 2023-11-18 225430](https://github.com/PastorEmil/Vulnerability_Managment/assets/125451135/420b0745-9e3a-4968-b486-ad39e2c5d7c2)
Next one is <a href="https://community.tenable.com/s/article/WinVerifyTrust-Signature-Validation-Mitigation-CVE-2013-3900?language=en_US">CVE-2013-3900</a> . 
![Screenshot 2023-11-18 225752](https://github.com/PastorEmil/Vulnerability_Managment/assets/125451135/9863257c-7d03-4266-ae1c-2e5d6ff669ba)
*<i>If a user is logged on with administrative user rights, an attacker who successfully exploited this
vulnerability could take complete control of an affected system. An attacker could then install
programs; view, change, or delete data; or create new accounts with full user rights. Users whose
accounts are configured to have fewer user rights on the system could be less impacted than users who operate with administrative user rights.
Exploitation of this vulnerability requires that a user or application run or install a specially crafted,
signed PE file. An attacker could modify an existing signed file to include malicious code without
invalidating the signature. This code would execute in the context of the privilege in which the
signed PE file was launched.*</i><p>
Microsoft suggests enabling Windows Authenticode to fix that problem.
Windows Authenticode is a digital signature format that is used to determine the origin and integrity
of software binaries. Authenticode uses Public-Key Cryptography Standards (PKCS) #7 signed data
and X.509 certificates to bind an Authenticode-signed binary to the identity of a software publisher.
The term "Authenticode signature" refers to a digital signature format that is generated and verified
using the WinVerifyTrust function<p>
There are 2 new registry entries to fix that cryptographic vulnerability.<br>
In these paths HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Cryptography\Wintrust\Config and <br>HKE
Y_LOCAL_MACHINE\SOFTWARE\WOW6432Node\Microsoft\Cryptography\Wintrust\Config (for x64
systems) I added the registry key EnableCertPaddingCheck with value 1
![Screenshot 2023-11-18 230720](https://github.com/PastorEmil/Vulnerability_Managment/assets/125451135/bdfad913-5641-490a-9ab1-e61d299665c4)
![Screenshot 2023-11-18 231311](https://github.com/PastorEmil/Vulnerability_Managment/assets/125451135/42bbbace-6107-453e-acc0-dc3c85f98263)
Done.Moving next.<p>









Wow, that's a bunch of vulnerabilities. They are from the “hardware family”, when through “holes” in
CPU, an attacker can gather information about the target.#there are CVE-2017-5753, CVE-2017-5715, CVE-2017-5754 in the list, which is more known as Spectre (CVE-2017-5753, CVE-2017-5715), and Meltdown (CVE-2017-5754). Analyzing the vulnerabilities of this group will take a lot of time and is worthy of a separate article. So I'll try to keep it short.





All these CVEs were fixed in Windows
updates, but the first mitigations were pretty harsh, like turning off hyper-threading, which seriously slows
down the computer. But in my case, this is Windows Server 2016, which didn't get that proper
update, but still can be repaired manually.#




According to vendor recommendations, we should add 2 new registry keys to fix the problem.
![Screenshot 2023-11-29 164428](https://github.com/PastorEmil/Vulnerability_Managment/assets/125451135/914b03ea-fdec-4415-b38b-6f10c4fec77f)
On this path HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Session Manager\Memory
Management should have 2 new registry keys.
FeatureSettingsOverride with value 48. 
FeatureSettingsOverrideMask with value 3
![Screenshot 2023-11-29 163930](https://github.com/PastorEmil/Vulnerability_Managment/assets/125451135/e1b17743-4458-4451-a4ba-f17ec20bd51f)
Next one.
<a hfref="https://msrc.microsoft.com/update-guide/en-US/advisory/CVE-2017-8529">CVE-2017-8529</a>
![Screenshot 2023-11-18 231913](https://github.com/PastorEmil/Vulnerability_Managment/assets/125451135/aa80ca1d-3b4a-4446-a685-9545f760742e)
This vulnerability may help attackers gain information about the machine through the affected Microsoft
browser.
*An attacker who successfully exploited the vulnerability could potentially read data that was not
intended to be disclosed. Note that the vulnerability would not allow an attacker to either execute
code or to elevate a user’s rights directly, but the vulnerability could be used to obtain information in
an attempt to further compromise the affected system.*
According to Microsoft, “exploitation is less likely”. The possibility of existing Microsoft browser
users is still relevant, so let's fix this.
![Screenshot 2023-11-28 205601](https://github.com/PastorEmil/Vulnerability_Managment/assets/125451135/30c24c8d-e3bc-4d37-85ed-94aa9f25d7ee)

Another new registry key FEATURE_ENABLE_PRINT_INFO_DISCIOSURE_FIX on the path 
HKEY_LOCAL_MACHINE\SOFTWARE\WOW6432Node\Microsoft\Internet Explorer\Main\FeatureControl. And
creating a new DWORD iexplore.exe with value 1
![Screenshot 2023-11-28 204503](https://github.com/PastorEmil/Vulnerability_Managment/assets/125451135/d44df026-239f-4573-9caa-6915c20de5e0)
All right, Nessus shows the last vulnerability, SMB signing should be enabled.
![Screenshot 2023-11-27 190402](https://github.com/PastorEmil/Vulnerability_Managment/assets/125451135/778fca64-222e-46e7-8d46-0abf28117aca)
![Screenshot 2023-11-27 190525](https://github.com/PastorEmil/Vulnerability_Managment/assets/125451135/65771455-a8fd-466b-908e-cff1a624d561)
To do this, I open Local Security Policies at the endpoint and look for Security Options for policies 
Microsoft network client/server
![Screenshot 2023-11-27 170921](https://github.com/PastorEmil/Vulnerability_Managment/assets/125451135/3058a4ed-f1a7-44ba-8267-f87e975d9bd3)
Parameters must be set as in the attached screenshot. ms net client: Digitally sign communications (if
server agrees) - Enabled; ms net server: Digitally sign communications (always) - Enabled<br>
After that, endpoints should be rebooted(or after the next step).<p>
Besides. Microsoft strongly recommends stopping using SMBv1, because it's pretty vulnerable.
Infamous <a href="https://attack.mitre.org/software/S0366/">WannaCry</a> was performed trough SMBv1. In my case, Win Server 2016 has it by default,
so let's disable it.<br>
Through the PowerShell (Run as Administrator!) this command checks the smb1 status on the server Get-SmbServerConfiguration |
Format-List EnableSMB1Protocol
![Screenshot 2023-11-27 152221](https://github.com/PastorEmil/Vulnerability_Managment/assets/125451135/af51b887-92d1-4844-8a65-e2da851841be)
Disable-WindowsOptionalFeature -Online -FeatureName SMB1Protocol for disabling SMBv1. Reboot
require
![Screenshot 2023-11-27 152503](https://github.com/PastorEmil/Vulnerability_Managment/assets/125451135/385c7d2d-3c1f-4017-af72-610f08ab55e9)
Ok. Let's rescan VMs after all these manipulations.
![Screenshot 2023-11-29 174016](https://github.com/PastorEmil/Vulnerability_Managment/assets/125451135/8077d024-b732-4707-ae78-01f593fed276)
![Screenshot 2023-11-29 174051](https://github.com/PastorEmil/Vulnerability_Managment/assets/125451135/711f94f6-a534-4a60-a821-46577e0e2a55)

![Screenshot 2023-11-28 202407](https://github.com/PastorEmil/Vulnerability_Managment/assets/125451135/132c307b-10ee-4362-889f-884a9e5aa725)
Seems much better now
*IMPORTANT NOTE* 
Win Server still has some "issues". 
![Screenshot 2023-11-29 174219](https://github.com/PastorEmil/Vulnerability_Managment/assets/125451135/dd9a71fa-ca7e-48f9-b320-c8227fff5343)

In our case, IP forwarding is enabled, because our server is used as a router for endpoints, for
educational purposes of course. And DHCP server too. So ignore them (for educational purposes, for
sure)<p>
![PubTThou01](https://github.com/PastorEmil/Vulnerability_Managment/assets/125451135/be8b9654-7d37-49e3-ad24-58791b120024)
